--Verifica se tem conexões ativas no banco de dados:

USE master
SELECT * FROM sys.sysprocesses WHERE dbid = DB_ID ('BANCO_TESTE_PRINCIPAL')

--Caso dê problema no SHRINKFILE do log, verificar e acertar nome lógico do Banco e do Log

ALTER DATABASE BANCO_TESTE_PRINCIPAL SET OFFLINE WITH ROLLBACK IMMEDIATE
ALTER DATABASE BANCO_TESTE_PRINCIPAL SET ONLINE

USE MASTER
GO
ALTER DATABASE BANCO_TESTE_PRINCIPAL MODIFY FILE (NAME = 'PENEDO', 
NEWNAME ='BANCO_TESTE_PRINCIPAL') 
GO
ALTER DATABASE BANCO_TESTE_PRINCIPAL MODIFY FILE (NAME = 'PENEDO_Log', 
NEWNAME ='BANCO_TESTE_PRINCIPAL_Log') 
GO

--Criar MaintenancePlan T-SQL

USE master
GO
SELECT database_id [ID],  name [Banco], compatibility_level [Versao],
 recovery_model_desc [Model] FROM sys.databases
  GO
ALTER DATABASE BANCO_TESTE_PRINCIPAL SET RECOVERY SIMPLE
 GO
 use BANCO_TESTE_PRINCIPAL
 GO
 sp_helpfile
 GO
 DBCC SHRINKFILE (BANCO_TESTE_PRINCIPAL_log, 1)
 GO
 ALTER DATABASE BANCO_TESTE_PRINCIPAL SET RECOVERY FULL
 GO
 
